<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="author" content="Bart Debunne">
<title>IIIF : Deliverable 4 - Image processing workflow</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>IIIF : Deliverable 4 - Image processing workflow</h1>
<div class="details">
<span id="author" class="author">Bart Debunne</span><br>
<span id="email" class="email"><a href="mailto:bart.debunne@meemoo.be">bart.debunne@meemoo.be</a></span><br>
<span id="revnumber">version 3,</span>
<span id="revdate">01-10-2021</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Inhoudsopgave</div>
<ul class="sectlevel1">
<li><a href="#_doelstelling">Doelstelling</a></li>
<li><a href="#_specificaties">Specificaties</a>
<ul class="sectlevel2">
<li><a href="#_afgeleide_beeldbestanden">Afgeleide beeldbestanden</a></li>
<li><a href="#_relatief_herschalen">Relatief herschalen</a></li>
</ul>
</li>
<li><a href="#_taken">Taken</a>
<ul class="sectlevel2">
<li><a href="#_export_etlextract">Export (*E*TL:extract)</a></li>
<li><a href="#_transformatie_etltransform">Transformatie (E*T*L:transform)</a>
<ul class="sectlevel3">
<li><a href="#_detecteer_en_verwijder_kleurenkaart">Detecteer en verwijder kleurenkaart</a></li>
<li><a href="#_herschaal">Herschaal</a></li>
<li><a href="#_detecteer_en_stel_kleurprofiel_icc_in">Detecteer en stel kleurprofiel (ICC) in</a></li>
<li><a href="#_sla_op_als_jpeg2000">Sla op als jpeg2000</a></li>
<li><a href="#_kopieer_metadata">Kopieer metadata</a></li>
<li><a href="#_valideer">Valideer</a></li>
</ul>
</li>
<li><a href="#_verplaats_etlload">Verplaats (ET*L*:load)</a></li>
<li><a href="#_ruim_op">Ruim op</a></li>
</ul>
</li>
<li><a href="#_workflow">Workflow</a></li>
<li><a href="#_tech_specs">Tech specs</a>
<ul class="sectlevel2">
<li><a href="#_omgevingen">Omgevingen</a></li>
<li><a href="#_stack">Stack</a></li>
<li><a href="#_execute">Execute</a></li>
<li><a href="#_observability">Observability</a></li>
</ul>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_doelstelling">Doelstelling</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_specificaties">Specificaties</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_afgeleide_beeldbestanden">Afgeleide beeldbestanden</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Voor afgeleide bestanden moet onderscheid worden gemaakt tussen werken in public domain en werken die nog onder het auteursrecht vallen. In de overeenkomst die de VKC momenteel met de auteursrechtenorganisatie Sabam heeft, worden volgende hergebruiksvoorwaarden vooropgesteld voor werken die onder het auteursrecht vallen: de resolutie van het gereproduceerde beeld mag niet meer dan 640x480 pixels zijn en een resolutie van maximum 72dpi hebben. Onderstaande specificaties hebben betrekking op werken die niet onder die overeenkomst vallen.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>jpeg-2000 (jp2)</p>
</li>
<li>
<p>300 ppi</p>
</li>
<li>
<p>sRGB</p>
</li>
<li>
<p>Bestanden worden bijgesneden (<em>crop</em>), randinformatie zoals kleurkaarten en kaders verwijderd</p>
</li>
<li>
<p>Embedded metadata(XMP, Exif, ICC) wordt indien aanwezig overgenomen van het origineel</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>We testen de workflow aan de hand van een representatieve referentieset van ca. 200 beelden. Deze set bevat de beelden uit fase 1 van het VKC IIIF-project aangevuld met een aantal werken van James Ensor.</p>
</div>
</div>
<div class="sect2">
<h3 id="_relatief_herschalen"><a id="rel-scale"></a>Relatief herschalen</h3>
<div class="paragraph">
<p>De te ontsluiten collectie is zowel qua type als qua fysieke afmeting zeer divers, voor de hele VKC-collectie spreken we over heel kleine objecten van een paar centimeter tot wandtapijten, of een wandkaart van ettelijke meters hoog en breed. De afmeting in pixels van het digitale beeld is niet per se in verhouding en is afhankelijk van het moment van de opname, de fotograaf, het opnametoestel, etc. Voor sommige grote werken zijn verschillende foto&#8217;s aan elkaar geplakt (stitching). Andere zijn gevat in 1 foto. Relatief gesproken kan een groter fysiek werk in aantal pixels kleiner of gelijk zijn aan een fysiek kleiner werk.</p>
</div>
<div class="paragraph">
<p>Grote bestanden betekenen echter een grotere relatieve kost aan opslag, bandbreedte en verwerking. Daarom dringt zich, zeker bij een groot aantal beelden, een beperking van de bestandsgrootte op, i.c. herschalen van de beelden naar een aanvaardbare grootte met minimaal kwaliteitsverlies.</p>
</div>
<div class="paragraph">
<p>Bij vaste herschaling wordt de langste of kortste zijde herleid tot een vooraf bepaalde waarde. Waarbij het resulterend bestand voldoende detail bevat en tegelijk de performantie waarborgt. Bij aanvang van het project werd dit bepaald als (max.) 5000 pixels voor de kortste zijde. Voor bestanden die merkelijk groter zijn dan die bovengrens betekent dit echter een veel ingrijpender herschaling met potentieel matig tot goed merkbaar kwaliteitsverlies. Dynamisch herschalen probeert deze impact te mitigeren door progressief te herschalen, eventueel in verhouding tot de fysieke grootte van het werk.</p>
</div>
<div class="paragraph">
<p>Om te vermijden dat (heel) grote werken te fel herschaald zouden worden ten opzichte van kleine werken met een in verhouding hoger aantal pixels, is daarom binnen dit project bekeken in welke mate een relatie bestaat tussen de fysieke en digitale afmetingen en of op basis daarvan de herschaling relatief of progressief kan gebeuren.</p>
</div>
<div class="paragraph">
<p>Aan de hand van de referentieset is gekeken of er een relevante correlatie is tussen de grootte van een afbeelding en de fysieke afmeting van een werk en of het al dan niet nuttig is rekening mee te houden bij het herschalen van het digitale beeld.</p>
</div>
<div class="paragraph">
<p>Voor 77 testbestanden uit de referentieset werden de fysieke  met de digitale afmetingen statistisch vergeleken in R. Alleen de breedte werd in aanmerking genomen om te compenseren voor afwijkingen door mogelijke kleurenkaartstroken onderaan de afbeelding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sample: 77
Mean width in cm: 90
Mean width in px: 6169
cor (pearson): 0.09

data:  cm and px
t = 0.80326, df = 75, p-value = 0.4244
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.1344031  0.3099238
sample estimates:
       cor
0.09235595</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/size-correlation-small-set.png" alt="Graph">
</div>
</div>
<div class="paragraph">
<p>Resultaat:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>gemiddelde breedte = 90 cm</p>
</li>
<li>
<p>gemiddeld aantal pixels = 6169px</p>
</li>
<li>
<p>geen correlatie tussen fysieke breedte en breedte in pixels: 0.09</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dit is slechts een kleine set met een slechte p-value! Een zelfde vergelijking werd daarom uitgevoerd op de volledige set aan beelden van VKC die beschikbaar zijn op Art in Flanders (AIF), met een gelijkaardig resultaat.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sample: 12639
Mean width in cm: 98
Mean width in px: 6024
cor (pearson): 0.23

data:  cm and px
t = 26.744, df = 12639, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.2148652 0.2478637
sample estimates:
     cor
0.231431</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/size-correlation-large-set.png" alt="Graph">
</div>
</div>
<div class="paragraph">
<p>Resultaat:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>gemiddelde breedte = 98 cm</p>
</li>
<li>
<p>gemiddeld aantal pixels = 6024px</p>
</li>
<li>
<p>weinig tot geen correlatie tussen fysieke breedte en breedte in pixels: 0.23</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Conclusie:</strong></p>
</div>
<div class="paragraph">
<p>De resolutie clustert rond een mediaan van 6050 pixels, met het gros tussen 4000 en 8000 pixels, afnemend in aantal boven 10.000px tot enkele zeldzame pieken boven 20.000px (max. 25k). Er is geen waarneembare correlatie tussen de fysieke afmeting van beelden en de resolutie in pixels.</p>
</div>
<div class="paragraph">
<p>Er wordt voorgesteld de fysieke afmeting los te laten en de digitale afmeting als leidend te zien. Om alsnog een balans tussen opslagcapaciteit, performantie en kwaliteit te waarborgen wordt volgende getrapte herschaling voorgesteld:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Afbeeldingen tot 5.000px breedte worden ongemoeid gelaten</p>
</li>
<li>
<p>Van 5.001-10.000px 50% herschalen</p>
</li>
<li>
<p>Max. breedte 10.000px</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(images)</p>
</div>
<div class="paragraph">
<p>De referentieset is opnieuw gehanteerd als representatieve controleset om de impact van het herschalen na te gaan.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Formaat</th>
<th class="tableblock halign-left valign-top">Totale bestandsgrootte</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archiefmaster TIFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">37,92 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Afgeleide JPEG2000 - niet herschaald</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5,95 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Afgeleide JPEG2000 - "dynamisch" herschaald</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4,92 GB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>De totale omvang van de afgeleide beelden is respectievelijk 15,5% en 13% van die van de originele archiefbestanden. Het verschil tussen herschalen of niet herschalen levert een besparing van ongeveer 20% op aan opslagcapaciteit: ca. 1GB minder per 200 beelden.</p>
</div>
<div class="paragraph">
<p>Er is visueel een kwaliteitsverlies waarneembaar bij het inzoomen. Bij de grootste beelden die verhoudingsgewijs meer herschaald zijn, is een verzachting van de contouren merkbaar. Het kwaliteitsverlies is progressief in die zin dat een origineel beeld van 15000px breed relatief meer effect zal ondervinden van herschaling dan een beeld van 7000px breed.</p>
</div>
<div class="paragraph">
<p>Hoewel er geen detail of kleur verloren lijkt te gaan, zijn de edges en details minder scherp waardoor de afbeelding minder crisp over komt op de hogere zoomniveau&#8217;s. In de hoofdzoom is geen verschil waar te nemen.</p>
</div>
<div class="paragraph">
<p><strong>Eindconclusie</strong></p>
</div>
<div class="paragraph">
<p>Het "dynamisch" herschalen levert een gemiddelde besparing in opslag van 20%. Voor grotere bestanden komt dit met een matig en progressief kwaliteitsverlies, waarneembaar bij de diepere zoomniveau’s als een "verzachting" van de details in het beeld.</p>
</div>
<div class="paragraph">
<p>Voor materiaal gelijkaardig qua resolutie aan de referentieset is de resulterende kwaliteit aanvaardbaar. Indien nog grotere beelden worden aangeboden dienen de drempelwaardes voor het herschalen echter herbekeken te worden.</p>
</div>
<div class="paragraph">
<p>Het lineair herschalen tot een grens van 5000px, zou een grotere degradatie van de kwaliteit betekenen voor beelden boven en is niet wenselijk.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_taken">Taken</h2>
<div class="sectionbody">
<div class="paragraph">
<p>De workflow kan gezien worden als een ETL-proces. Hierin worden min of meer procedureel de volgende taken uitgevoerd:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Haal bestand op van tape aan de hand van een id</p>
</li>
<li>
<p>Detecteer randinformatie en snij bij indien nodig</p>
</li>
<li>
<p>Herschaal tot bepaalde grootte</p>
</li>
<li>
<p>Zet om naar sRGB kleurprofiel</p>
</li>
<li>
<p>Sla op als gecomprimeerde jp2 inclusief originele metadata</p>
</li>
<li>
<p>Analyseer en valideer resultaat</p>
</li>
<li>
<p>Verplaats naar eindbestemming</p>
</li>
<li>
<p>Kuis tussenbestandenop</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_export_etlextract">Export (*E*TL:extract)</h3>
<div class="paragraph">
<p>In deze stap worden de originele archiefmasters uit het archiefsysteem (MAM) geësxporteerd via de export API van het MAM. De ongecomprimeerde hoge-resolutie tiff-bestanden worden hierbij van tape naar lokale disk in de VM gekopieerd. Een export kan geïnitieerd worden voor 1 of meerdere bestanden ineens.</p>
</div>
<div class="paragraph">
<p>Voor het exporteren van een esssence is een Mediahaven fragment-id nodig. Indien niet bekend kan die eerst worden opgehaald aan de hand van de meemoo-identifer (pid) of overige lokale id met een metadata query naar de REST API.</p>
</div>
<div class="paragraph">
<p>Voor meer informatie over de REST API van MediaHaven en het exporteren van essences zie de <a href="https://archief.viaa.be/mediahaven-rest-api/#mediahaven-rest-api-manual-exporting">Mediahaven REST API manual</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transformatie_etltransform">Transformatie (E*T*L:transform)</h3>
<div class="sect3">
<h4 id="_detecteer_en_verwijder_kleurenkaart">Detecteer en verwijder kleurenkaart</h4>
<div class="paragraph">
<p>Voor het detecteren van de kleurenkaart maken we gebruik van de <a href="https://github.com/tckrishna/colorchecker">colorchecker</a> zoals ontwikkeld voor het <a href="https://www.floredegand.be">Flore de Gand project</a>. De colorchecker gaat op zoek naar een kleurenkaart en als die wordt herkend dan wordt de strook met de kleurenkaart weggesneden en de afbeelding opgeslaan.</p>
</div>
<div class="paragraph">
<p>De colorchecker zou ook in staat moeten zijn om kaders en randen te detecteren, zoals een passe-partout of lijst. Indien gewenst zou het in een volgende fase mogelijk zijn om een model te trainen om ook dit bij te snijden.</p>
</div>
<div class="quoteblock">
<blockquote>
The code is such that, when an input image is provided, it would perform detections and crop out the colour scale so that only the painting would be saved.
</blockquote>
</div>
<div class="paragraph">
<p>Code: <a href="https://github.com/tckrishna/colorchecker.git" class="bare">https://github.com/tckrishna/colorchecker.git</a>
Documentatie en tutorial op: <a href="https://colab.research.google.com/drive/1OreAxCrCTkTqbIxu2Z_8KWuCujKyyncI?usp=sharing" class="bare">https://colab.research.google.com/drive/1OreAxCrCTkTqbIxu2Z_8KWuCujKyyncI?usp=sharing</a></p>
</div>
<div class="paragraph">
<p>Omdat de oorspronkelijke code moeilijk overweg kon met 16-bit bestanden en de kleurenkaart verbergt onder een wit vlak ipv deze volledige weg te snijden heeft meemoo een paar <a href="https://github.com/viaacode/colorchecker/commits/main">aanpassingen gedaan in een eigen fork</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_herschaal">Herschaal</h4>
<div class="paragraph">
<p>De afbeelding worden dynamisch herschaald cfr. supra <a href="#rel-scale">Relatief herschalen</a>.</p>
</div>
<div class="paragraph">
<p>De afmeting wordt herschaald op basis van de kortste zijde:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt; 5000px: niet herschalen</p>
</li>
<li>
<p>&gt; 5000px: herschalen naar (5000 + zijde - 5000) /2</p>
</li>
<li>
<p>&gt; 15000px: herschalen naar 10000</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Voorbeelden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3650 &#8658; 3650</p>
</li>
<li>
<p>6200 &#8658; 5600</p>
</li>
<li>
<p>10000&#8658; 7500</p>
</li>
<li>
<p>17000 &#8658; 10000</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Code: <a href="https://github.com/viaacode/iiif-image-processing/blob/main/app/helpers.py#L128" class="bare">https://github.com/viaacode/iiif-image-processing/blob/main/app/helpers.py#L128</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_detecteer_en_stel_kleurprofiel_icc_in">Detecteer en stel kleurprofiel (ICC) in</h4>
<div class="paragraph">
<p>We detecteren het kleurenprofiel van het om te zetten beeldbestand en indien afwezig of anders wordt het omgezet naar <code>sRGB</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sla_op_als_jpeg2000">Sla op als jpeg2000</h4>
<div class="paragraph">
<p>Voor het comprimeren en opslaan als jp2 gebruiken we de gelicensieerde Kakadu software. We gebruiken <a href="https://image-processing.readthedocs.io/en/latest/jp2_profile.html">het profiel van Digital Bodleian</a>: <a href="https://github.com/viaacode/iiif-image-processing/blob/main/app/file_transformation.py#L97" class="bare">https://github.com/viaacode/iiif-image-processing/blob/main/app/file_transformation.py#L97</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>kdu_compress -i input.tif -o output.jp2 Clevels=6 Clayers=6 "Cprecincts={256,256},{256,256},{128,128}" "Stiles={512,512}" Corder=RPCL ORGgen_plt=yes ORGtparts=R "Cblk={64,64}" -jp2_space "sRGB" Cuse_sop=yes Cuse_eph=yes -flush_period 1024 Creversible=no -rate 3</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The JPEG 2000 format supports only a restricted set of ICC Profile features.
The <a id="kdu-icc"></a>-jp2_space parameter on kdu_compress sets the colour profile in the image metadata, but does not otherwise convert the image - the pixel values remain the same. The sRGB value sets the colour profile to the sRGB IEC61966-2.1 profile. (This is not the only way to set the colour profile)
Kakadu (and JP2 itself) will not support CYMK images:
Only three colour channels, R (red), G (green) and B (blue), are supported by the JP2 file format.
For example the sRGB v4 ICC preference profile is not supported, and cannot be embedded into a JP2 file using Kakadu. Setting -jp2_space sRGB on kdu_compress will erase the embedded profile and so allow it to be converted. The sRGB IEC61966-2.1 profile thus assigned is sufficiently different that in some cases there is a noticeable tint to the created JP2.
<em><a href="https://readthedocs.org/projects/image-processing/downloads/pdf/latest/" class="bare">https://readthedocs.org/projects/image-processing/downloads/pdf/latest/</a></em>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Het instellen van de sRGB color space in de vorige stap voorkomt problemen (afwijkende kleur) gerelateerd aan de expliciete toekenning van de sRGB space in kdu_compress.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kopieer_metadata">Kopieer metadata</h4>
<div class="paragraph">
<p>kdu_compress kopieert niet alle metadata tags.</p>
</div>
<div class="paragraph">
<p>Met behulp van een tool als. <em>exiftool</em> worden alle embedded metadatatags zoals XMP en IPTC uit het origineel gelezen en gekopieerd naar het afgeleide bestand. Onderstaand commando bijvoorbeeld geeft alle XMP en IPTC tags gegroepeerd per <em>tag family</em> terug in JSON-formaat.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>exiftool 7659c97c0w.tif <span class="nt">-XMP</span>:All <span class="nt">-IPTC</span>:All <span class="nt">-g0</span>:1 <span class="nt">-json</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Op deze manier kan ook metadata cleaning worden gedaan van bron naar afgeleide. Het kan bijvoorbeeld nuttig zijn redundante of verouderde en niet (langer) relevante tags eerst te verwijderen. Het is eveneens mogelijk in deze stap tags toe te voegen op basis van metadata uit het MAM of de VKC-databronnen.</p>
</div>
<div class="paragraph">
<p>Zie voor meer informatie de <a href="https://exiftool.org/">Exiftool website</a> en de <a href="https://manpages.ubuntu.com/manpages/artful/man1/exiftool.1p.html">Exiftool manual met voorbeelden.</a></p>
</div>
<div class="paragraph">
<p>Meer info over IPTC: <a href="http://www.iptc.org/std/photometadata/specification/IPTC-PhotoMetadata" class="bare">http://www.iptc.org/std/photometadata/specification/IPTC-PhotoMetadata</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_valideer">Valideer</h4>
<div class="paragraph">
<p>Valideer dat het eindresultaat voldoet aan de volgende assertions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ppi = 300</p>
</li>
<li>
<p>icc = sRGB</p>
</li>
<li>
<p>metadata tags = source file tags</p>
</li>
<li>
<p>file format = valid jp2</p>
</li>
<li>
<p>file name = pid</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://jpylyzer.openpreservation.org" class="bare">https://jpylyzer.openpreservation.org</a>
<a href="https://github.com/openpreserve/jpylyzer" class="bare">https://github.com/openpreserve/jpylyzer</a>
<a href="https://exiftool.org/index.html" class="bare">https://exiftool.org/index.html</a>
<a href="https://exiftool.org/exiftool_pod.html" class="bare">https://exiftool.org/exiftool_pod.html</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verplaats_etlload">Verplaats (ET*L*:load)</h3>
<div class="paragraph">
<p>Bestanden worden naar de eindbestemming gekopieerd waar ze steekproefsgewijs visueel geïnspecteerd kunnen worden. Als bestandsnaam wordt de meemoo pid (external_id) gebruikt en <code>.jp2</code> als extensie.</p>
</div>
<div class="paragraph">
<p>De eindbestemming is een folder die de media mount point is voor de IIPImage server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ruim_op">Ruim op</h3>
<div class="paragraph">
<p>Tussentijdse bestanden en met succes verwerkte bronbestanden worden verwijderd.
Gefaalde bestanden blijven staan voor inspectie.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_workflow">Workflow</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="https://cawemo.com/share/d893035f-bdbc-419b-9524-e9ff161992d7"><img src="../images/iiif-jp2-derived-image-workflow.svg" alt="workflow voor creatie afgeleiden als jp2"></a>
</div>
<div class="title">Figure 1. Voorbeeld manuele workflow voor creatie van jp2 afgeleide beeldbestanden</div>
</div>
<div class="paragraph">
<p>Voor de creatie van de afgeleiden starten we met een vrij manuele workflow die eenvoudig kan bijgesteld worden om uiteindelijk te komen tot een automatiseerbare workflow.
Om zowel de workflow voor de creatie van afgeleide beelden als de specificaties an sich te testen beperken we ons in eerste instantie tot de omzetting van de beelden die nu reeds beschikbaar zijn in de IIIF-viewer in de VKC Arthub. Hierbij zal worden onderzocht welke een haalbare workflow is voor de aanmaak van de afgeleide beeldbestanden en in welke mate dit proces geautomatiseerd kan worden. Indien nodig kunnen bovenstaande specificaties dan ook bijgewerkt worden op basis van voortschrijdend inzicht.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tech_specs">Tech specs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_omgevingen">Omgevingen</h3>
<div class="paragraph">
<p>DEV: lokale omgeving bij dev
QAS en PRD: Debian VM + data store (disk)</p>
</div>
<div class="paragraph">
<p>Deployment via Puppet/Foreman en parametriseerbaar.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stack">Stack</h3>
<div class="ulist">
<ul>
<li>
<p>Taal: Python</p>
</li>
<li>
<p>Metadata read/write: exiftool</p>
</li>
<li>
<p>jp2 schrijven: kdu_compress (kakadu)</p>
</li>
<li>
<p>jp2 validatie: jpylyzer</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_execute">Execute</h3>
<div class="paragraph">
<p>Manueel.</p>
</div>
<div class="paragraph">
<p>In latere fase automated trigger op basis van metadata attribuut in MAM.</p>
</div>
</div>
<div class="sect2">
<h3 id="_observability">Observability</h3>
<div class="paragraph">
<p>Single line json logging naar stdout &#8658; ELK.</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>